#!/bin/bash

pdir=$(dirname $0)

[[ -z $pdir ]] && pdir="."

TEMP=$(getopt -o '' -l prefix: -n $0 -- $*)

[[ $? != 0 ]] && exit 1

eval set -- "$TEMP"

while true
do
	case "$1" in
		(--prefix)
			prefix=$2
			shift 2
		;;
		(--)
			shift
			break
		;;
	esac
done

prefix=${prefix:-/usr/local}
echo Prefix: $prefix

template=$pdir/Makefile-template

if [[ ! -f $template ]]
then
	echo "error: missing template Makefile $template"
	exit 1
fi

echo "Creating Makefile..."
if ! ( echo "PDIR:=$pdir" > Makefile \
	&& echo "PREFIX:=$prefix" >> Makefile \
	&& cat $template >> Makefile )
then
	echo "error: failed to create Makefile"
	exit 1
fi

echo "Configuration complete. Just run make to build."

exit 0
